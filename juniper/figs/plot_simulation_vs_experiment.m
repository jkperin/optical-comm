clear, clc, close all

addpath data/
addpath f/ % Juniper project specific functions
addpath ../mpam % PAM
addpath ../f % general functions
addpath ../soa % for pre-amplifier 
addpath ../apd % for PIN photodetectors

BERcount = [0.00296903292635433,0.00128878914044590,0.000608260295257176,0.000277029441404258,0.000106395365176998,4.01491944064142e-05,3.21193555251314e-05,1.20447583219243e-05,2.00745972032071e-06,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
BERgauss = [0.00112208819611600,0.000382424996883541,0.000121855212635715,3.14617713630098e-05,5.13373307478901e-06,5.89472770824903e-07,5.36743288428296e-08,1.88012047313734e-09,3.23540152342903e-11,2.86822278003616e-13,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
OSNRdB0ps = [24.9970979621932,25.9970979621932,26.9970979621933,27.9970979621933,28.9970979621933,29.9970979621933,30.9970979621932,31.9970979621933,32.9970979621934,33.9970979621934,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

BERcount20ps = [0.00247059257347247,0.00124553920785345,0.000583846503681306,0.000256073027930397,8.19433689377271e-05,5.12146055860795e-05,1.63886737875454e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
BERgauss20ps = [0.000888274433417137,0.000378553507745771,0.000116906827800000,2.62583489022948e-05,4.92248899247693e-06,6.70717101877028e-07,4.78070780270221e-08,2.47989390947621e-09,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
OSNRdB20ps = [24.9970979621933,25.9970979621932,26.9970979621933,27.9970979621934,28.9970979621933,29.9970979621932,30.9970979621933,31.9970979621932,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

BERcount100ps = [0.00341089273203289,0.00184372580109886,0.000895231305644669,0.000432251271146511,0.000106526379619045,5.53117740329658e-05,4.09716844688636e-05,6.14575267032954e-06,4.09716844688636e-06,6.14575267032954e-06,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
BERgauss100ps = [0.00134145275323137,0.000602450391240927,0.000227892563801874,6.18607435612911e-05,1.20935070329114e-05,2.16879839872727e-06,1.74149911487472e-07,9.82417315327687e-09,3.20301306649633e-10,5.20363018414533e-12,1.52599975847147e-14,0,0,0,0,0,0,0,0,0,0,0,0,0];
OSNRdB100ps = [24.9970979621932,25.9970979621933,26.9970979621931,27.9970979621932,28.9970979621933,29.9970979621932,30.9970979621933,31.9970979621933,32.9970979621932,33.9970979621933,34.9970979621933,0,0,0,0,0,0,0,0,0,0,0,0,0];

BERcount200ps = [0.0126684448377726,0.00767399650101815,0.00494733089961528,0.00276763728587173,0.00175973384793769,0.00100175768526371,0.000596138009021965,0.000338016396868124,0.000163886737875454,0.000127012221853477,5.73603582564090e-05,4.30202686923067e-05,2.45830106813181e-05,1.63886737875454e-05,1.22915053406591e-05,8.19433689377271e-06,1.02429211172159e-05,2.04858422344318e-06,4.09716844688636e-06,1.02429211172159e-05,0,0,0,0];
BERgauss200ps = [0.00685336762715378,0.00318992437712560,0.00171905563840335,0.000827280436014693,0.000264161802129761,9.34739605314745e-05,2.14772711114613e-05,5.24802047842906e-06,3.68229440464521e-07,3.04262813299770e-08,1.02950144665441e-09,3.43755304918290e-11,1.55132631590450e-13,1.32607643992260e-16,8.77718164124927e-20,3.89803646187892e-24,2.29949400557584e-30,1.08795670114157e-36,2.08615623100885e-45,1.08177171584974e-56,7.23284290943577e-71,0,0,0];
OSNRdB200ps = [24.9970979621933,25.9970979621934,26.9970979621933,27.9970979621933,28.9970979621933,29.9970979621932,30.9970979621934,31.9970979621932,32.9970979621933,33.9970979621932,34.9970979621934,35.9970979621933,36.9970979621933,37.9970979621932,38.9970979621932,39.9970979621932,40.9970979621932,41.9970979621932,42.9970979621933,43.9970979621932,44.9970979621932,0,0,0];


% figure(1), hold on
load('PAM4_Oclaro_experiment_summary');
% load('PAM4_experiment_summary');

% plot(Experiment('PAM4_56G_BER_vs_OSNR_0km_set2').OSNRdB, log10(Experiment('PAM4_56G_BER_vs_OSNR_0km_set2').BER.count),...
%     '-ok', 'LineWidth', 2, 'DisplayName', 'Experiment 2')
% plot(Experiment('PAM4_56G_BER_vs_OSNR_10km_set1').OSNRdB, log10(Experiment('PAM4_56G_BER_vs_OSNR_10km_set1').BER.count),...
%     '-ok', 'LineWidth', 2, 'DisplayName', 'Experiment 3')
% legend('-DynamicLegend')

alpha = 0;
OSNRdB = linspace(24, 40);
ber = pam_ber_from_osnr(4, OSNRdB, 56e9/4);

[BER0km, OSNRdB0km] = pam_sim_fun(0, alpha, 9);
figure(7)
hline(1) = semilogy(OSNRdB0km, BER0km.count, '-o', 'LineWidth', 4);
hold on
[BER5km, OSNRdB5km] = pam_sim_fun(5, alpha, 9);
figure(7)
hline(2) = semilogy(OSNRdB5km, BER5km.count, '-o', 'LineWidth', 4);
[BER10km, OSNRdB10km] = pam_sim_fun(10, alpha, 9);
figure(7)
hline(3) = semilogy(OSNRdB10km, BER10km.count, '-o', 'LineWidth', 4);
semilogy(OSNRdB, ber, ':k', 'LineWidth', 4) 

% semilogy(Experiment('PAM4_56G_BER_vs_OSNR_0km_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_0km_set1').BER.count,...
%     '-s', 'LineWidth', 4, 'Color', get(hline(1), 'Color'))
% semilogy(Experiment('PAM4_56G_BER_vs_OSNR_0km_set2').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_0km_set2').BER.count,...
%     ':s', 'LineWidth', 4, 'Color', get(hline(1), 'Color'), 'MarkerFaceColor', get(hline(1), 'Color'))
% semilogy(Experiment('PAM4_56G_BER_vs_OSNR_5km_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_5km_set1').BER.count,...
%     ':s', 'LineWidth', 4, 'Color', get(hline(2), 'Color'), 'MarkerFaceColor', get(hline(2), 'Color'))
% semilogy(Experiment('PAM4_56G_BER_vs_OSNR_10km_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_10km_set1').BER.count,...
%     ':s', 'LineWidth', 4, 'Color', get(hline(3), 'Color'), 'MarkerFaceColor', get(hline(3), 'Color'))

semilogy(Experiment('PAM4_56G_BER_vs_OSNR_0km_predist_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_0km_predist_set1').BER.count,...
    ':s', 'LineWidth', 4, 'Color', get(hline(1), 'Color'), 'MarkerFaceColor', get(hline(1), 'Color'))
semilogy(Experiment('PAM4_56G_BER_vs_OSNR_5km_predist_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_5km_predist_set1').BER.count,...
    ':s', 'LineWidth', 4, 'Color', get(hline(2), 'Color'), 'MarkerFaceColor', get(hline(2), 'Color'))
semilogy(Experiment('PAM4_56G_BER_vs_OSNR_10km_predist_set1').OSNRdB, Experiment('PAM4_56G_BER_vs_OSNR_10km_predist_set1').BER.count,...
    ':s', 'LineWidth', 4, 'Color', get(hline(3), 'Color'), 'MarkerFaceColor', get(hline(3), 'Color'))

xlabel('OSNR (dB)', 'FontSize', 18)
ylabel('BER', 'FontSize', 18)
legend('0 km', '5 km', '10 km', 'AWGN limit')
axis([26 38 1e-5 1e-1])
set(gca, 'FontSize', 18)
set(gca, 'ytick', [1e-5 1e-4 1e-3 1e-2 1e-1])
grid on

