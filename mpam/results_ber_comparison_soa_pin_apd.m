clear, clc, close all

tx.PtxdBm = -30:1:-12;

%% Equally-spaced levels
ber_pin.eq_spaced.count = [0.464808223463346,0.455306186290667,0.442766511017518,0.426630310382714,0.404093610755051,0.376177859671611,0.339468694683513,0.294131111518037,0.245549884026125,0.195562854788500,0.148916750595129,0.105606802783373,0.0656196590978453,0.0330592306048953,0.0122211286089239,0.00269334065799915,0.000293749618506989,1.04910578038210e-05,0];
ber_pin.eq_spaced.gauss = [0.349237622702391,0.342593920727185,0.334255214258206,0.323806707175755,0.310749279079702,0.294499485596141,0.274409379516046,0.249827405001154,0.220236317178201,0.185519641337322,0.146404322923543,0.105045480748196,0.0654538770109949,0.0329936264627572,0.0120514175516306,0.00268867082597775,0.000281577823051733,9.30157074634866e-06,5.46785217655125e-08];

%
ber_soa.eq_spaced.count = [0.193783260067085,0.142251304712858,0.0928756183912283,0.0546827513159452,0.0298047318092870,0.0150933002489545,0.00692036054789297,0.00278217092371786,0.000958219690757999,0.000278049142302247,6.70532134796128e-05,1.33477484694659e-05,2.19071806774366e-06,2.88808008441698e-07,2.80337064723424e-08,1.75755693631063e-09,6.20339330773770e-11,1.07554582443498e-12,7.93586920229700e-15];
ber_soa.eq_spaced.est = [0.193783260067085,0.142251304712858,0.0928756183912283,0.0546827513159452,0.0298047318092870,0.0150933002489545,0.00692036054789297,0.00278217092371786,0.000958219690757999,0.000278049142302247,6.70532134796128e-05,1.33477484694659e-05,2.19071806774366e-06,2.88808008441698e-07,2.80337064723424e-08,1.75755693631063e-09,6.20339330773770e-11,1.07554582443498e-12,7.93586920229700e-15];

%
ber_apd_fin.eq_spaced.count = [0.237052127205030,0.189415094915461,0.146293986144174,0.104909624305683,0.0679954068241470,0.0372318104132332,0.0165501205517915,0.00543532167490692,0.00137528230482818,0.000217451016297381,2.57507782457425e-05,9.53732527620094e-07,0,0,0,0,0,0,0];
ber_apd_fin.eq_spaced.gauss = [0.215027785988456,0.181032101346573,0.143508281034321,0.104615336380027,0.0678583609888391,0.0374624859598918,0.0166434724962490,0.00559272463542779,0.00134444568559010,0.000221269836315951,2.37319341486989e-05,1.53669903717772e-06,5.34197686667760e-08,8.42675374078626e-10,4.89426305084116e-12,8.39492786141940e-15,3.40393009934258e-18,2.59903112373720e-22,2.98372946296468e-27];

%
ber_apd_inf.eq_spaced.count = [0.127985182811451,0.0917576527498016,0.0602940166636147,0.0351879616065434,0.0178615027772691,0.00785303363242385,0.00305289782091192,0.000989020631142038,0.000222219678935482,4.29179637429042e-05,9.53732527620094e-06,0,0,0,0,0,0,0,0];
ber_apd_inf.eq_spaced.gauss = [0.126821536665829,0.0916817130222999,0.0601701179042403,0.0351343070921254,0.0179675009668366,0.00796294718129267,0.00301963602092677,0.000958496730744798,0.000246727795170630,4.92451967322406e-05,7.17388541883247e-06,7.03717456619697e-07,4.17272045846025e-08,1.30777941860144e-09,1.85693794442359e-11,1.00569543444480e-13,1.71515642619109e-16,7.46059744018531e-20,6.61526056323651e-24];


%% Optimized level spacing
ber_pin.optimized.count = [0.464794871207960,0.454939953000061,0.442540476408472,0.425606955380577,0.404312969236404,0.375705762070439,0.339522103705060,0.293887909723494,0.244989089299884,0.194758858267717,0.148054576390161,0.105228170969908,0.0648862387841055,0.0329848394677410,0.0118033937618263,0.00256649423182567,0.000247016724653604,1.43059879143014e-05,0];
ber_pin.optimized.gauss = [0.349151778385522,0.342486119780761,0.334120027673315,0.323637544578959,0.310538319437879,0.294237802246807,0.274087488520001,0.249436641895274,0.219771675615925,0.184984837699869,0.145819359964904,0.104454675283741,0.0649268558894527,0.0326058341706113,0.0118392956662387,0.00261493061051320,0.000268705612124277,8.51372913373398e-06,4.50022125996482e-08];

%
ber_soa.optimized.count = [0.181507698528963,0.124261811023622,0.0713878334248917,0.0342552111945309,0.0126751052920710,0.00359843282671062,0.000720068058353171,0.000148782274308735,2.76582433009827e-05,4.76866263810047e-06,0,0,0,0,0,0,0,0,0];
ber_soa.optimized.est = [0.161854186677478,0.112064166340681,0.0661748882433615,0.0317123916499724,0.0118220390294853,0.00333480101913837,0.000723615794687632,0.000139738759774525,3.06142867778370e-05,7.17300119284132e-06,1.37272582714194e-06,1.82642223637534e-07,1.52934810559860e-08,7.26301805658938e-10,1.72333530297539e-11,1.74939373371301e-13,6.30251553013883e-16,6.46030291402709e-19,1.45850487206401e-22];

%
ber_apd_fin.optimized.count = [0.230407472685100,0.183810008850638,0.140049899285845,0.0999731047427211,0.0636893044619423,0.0339137749496429,0.0142697460782518,0.00415541262284075,0.000726744186046512,6.10388817676860e-05,9.53732527620094e-07,0,0,0,0,0,0,0,0];
ber_apd_fin.optimized.gauss = [0.210778843696057,0.176335492473531,0.138588722477100,0.0998164653087088,0.0635768235573234,0.0340266219444577,0.0142218602493809,0.00418467708771848,0.000752578303039448,6.96601645575473e-05,2.85022050338319e-06,4.85282752778680e-08,3.29379181899162e-10,7.69772339682445e-13,4.83635620433831e-16,5.85992792980343e-20,9.55341386187362e-25,1.49706120541735e-30,1.65098159784139e-37];

%
ber_apd_inf.optimized.count = [0.0758265046084356,0.0491620506012330,0.0282400201428310,0.0139292635658915,0.00573956235121773,0.00175868278093145,0.000391984068851859,8.10672648477080e-05,4.76866263810047e-06,0,0,0,0,0,0,0,0,0,0];
ber_apd_inf.optimized.gauss = [0.0756709061354638,0.0492054044951657,0.0283698195498705,0.0140012679073031,0.00565788811842483,0.00177491387537260,0.000407524305678209,6.45779037046901e-05,6.67222422765784e-06,4.19063489960530e-07,1.43545166173706e-08,2.30772239756844e-10,1.45681035612740e-12,2.93119071775299e-15,1.46580828369098e-18,1.36034820412002e-22,1.66415457588676e-27,1.79236595320711e-33,1.07706353192394e-40];

%% Figures
figure, hold on, grid on, box on
plot(tx.PtxdBm, log10(ber_soa.eq_spaced.est), '-b')
plot(tx.PtxdBm, log10(ber_apd_fin.eq_spaced.gauss), '-r')
plot(tx.PtxdBm, log10(ber_apd_inf.eq_spaced.gauss), '-m')
plot(tx.PtxdBm, log10(ber_pin.eq_spaced.gauss), '-k')

plot(tx.PtxdBm, log10(ber_soa.eq_spaced.count), '-ob')
plot(tx.PtxdBm, log10(ber_apd_fin.eq_spaced.count), '-or')
plot(tx.PtxdBm, log10(ber_apd_inf.eq_spaced.count), '-om')
plot(tx.PtxdBm, log10(ber_pin.eq_spaced.count), '-ok')


xlabel('Received Power (dBm)')
ylabel('log(BER)')
legend('SOA', 'APD Gain x BW = 340 GHz', 'APD Gain x BW = Inf', 'PIN', 'Location', 'SouthWest')
axis([tx.PtxdBm(1) tx.PtxdBm(end) -8 0])
set(gca, 'xtick', tx.PtxdBm)

%%
figure, hold on, grid on, box on
plot(tx.PtxdBm, log10(ber_soa.optimized.est), '-b')
plot(tx.PtxdBm, log10(ber_apd_fin.optimized.gauss), '-r')
plot(tx.PtxdBm, log10(ber_apd_inf.optimized.gauss), '-m')
plot(tx.PtxdBm, log10(ber_pin.optimized.gauss), '-k')

plot(tx.PtxdBm, log10(ber_soa.optimized.count), '-ob')
plot(tx.PtxdBm, log10(ber_apd_fin.optimized.count), '-or')
plot(tx.PtxdBm, log10(ber_apd_inf.optimized.count), '-om')
plot(tx.PtxdBm, log10(ber_pin.optimized.count), '-ok')

xlabel('Received Power (dBm)')
ylabel('log(BER)')
legend('SOA', 'APD Gain x BW = 340 GHz', 'APD Gain x BW = Inf', 'PIN', 'Location', 'SouthWest')
axis([tx.PtxdBm(1) tx.PtxdBm(end) -8 0])
set(gca, 'xtick', tx.PtxdBm)